# blackpill-usb-sha256

`blackpill-usb-sha256` &mdash; учебный проект, который демонстрирует подход к написанию
приложений для контроллера
[STM32F411CEU6 (WeAct Black Pill V2.0)](https://stm32-base.org/boards/STM32F411CEU6-WeAct-Black-Pill-V2.0.html)
использующих криптографические функции над данными, получаемыми по USB.
В то же время, `blackpill-usb-sha256` можно использовать в качестве шаблона для
написания таких приложений.

Для реализации криптографических функций и алгоритмов в проект используется библиотека
[WolfSSL](https://www.wolfssl.com/).

Приложение из проекта работает следующим образом:
1. после подачи питания контроллер инициализирует необходимую периферию и библиотеку WolfSSL;
2. контроллер ожидает получения данных по USB;
3. полученные данные накапливаются во внутреннем буфере;
4. последний байт очередного пакета данных сравнивается с символом переноса каретки
    (`\r`, 0xD в таблице ASCII);
5. после успешного сравнения контроллер рассчитывает хэш полученных данных (без
    учета символа переноса каретки) по алгоритму
    [SHA256](https://cryptoteh.ru/sha-256/)
    с использованием WolfSSL;
6. полученный хэш преобразуется в hex-строку (строку, в котором каждому байту хэша
    соответствует 2 символа шестандцатеричного представления числа, т.е. `0xFF` &rarr; `"FF"`);
7. hex-строка отправляется по USB ответным пакетом.

Для сборки этого проекта **не** требуется среда разработки
[STM32CubeIDE](https://www.st.com/en/development-tools/stm32cubeide.html)
и встроенный в нее генератор кода STM32CubeMX.
Код библиотек HAL и CMSIS включен в проект в подмодулем Git, а код инициализации
контроллера предварительно сгенерирован и помещен в статическую библиотеку, которая
собирается в проекте.

## Компиляция проекта

Компиляция проекта состоит из подготовки рабочего окружения и, собственно, компиляции.
Подготовка рабочего окружения происходит один раз.
В нее входит установка кросс-компилятора для процессоров семейства ARM и сборка главной
зависимости проекта &mdash; библиотеки WolfSSL.
Все инструкции написаны для Debian-based операционных систем Linux (Debain, Ubuntu и др.).

### Установка нужных системных пакетов и приложений

1. Установите Python:
    ```console
    $ sudo apt install python3 python3-pip python-is-python3
    ```

2. Установите пакет `build-essential`
    ```console
    $ sudo apt install build-essential
    ```

#### Установка Conan

[Conan](https://docs.conan.io/2/) является пакетным менеджером C и C++.
В этом проекте он используется для установки кросс-компилятора и библиотеки WolfSSL.

> [!NOTE]
> Пакеты Conan устанавливаются в директорию `${HOME}/.conan2` и не мешаеют системным
> пакетам, установленным с помощью `apt`.
> Для их установки не требуется прав суперпользователя.

